app.controller("selfEditCtrl",["$scope","Upload","httpService","$state","$stateParams","$filter","curUserService","Config","$cordovaDatePicker",function($scope,Upload,httpService,$state,$stateParams,$filter,curUserService,configs,$cordovaDatePicker){$scope.userInfo=curUserService.getCurUser(),$scope.items=["男","女"],$scope.submitForm=function(){$scope.upload()};var options={date:new Date,mode:"date",minDate:new Date-1e4,allowOldDates:!0,allowFutureDates:!1,doneButtonLabel:"DONE",doneButtonColor:"#F2F3F4",cancelButtonLabel:"CANCEL",cancelButtonColor:"#000000"};document.addEventListener("deviceready",function(){$cordovaDatePicker.show(options).then(function(date){console.log(date)})},!1),$scope.loadFile=function(file){$scope.file=file};var loadUser=function(){var curUserReq=httpService.post("user/"+$stateParams.account);curUserReq.then(function(data){""!=data.data&&void 0!=data.data.imgPath&&(data.data.imgPath=configs.imgPrefix+data.data.imgPath),curUserService.setCurUser(data.data),$state.go("app.self.index")},function(error){console.log("下载头像失败:"+error)})};$scope.upload=function(fn){Upload.upload({url:configs.serverUrl+"/user/upload",data:{account:$scope.userInfo.userName},file:$scope.file}).progress(function(evt){var progressPercentage=parseInt(100*evt.loaded/evt.total);console.log("progress: "+progressPercentage+"% "+evt.config.file.name)}).error(function(data,status,headers,config){console.log("上传失败")}).success(function(data,status,headers,config){$scope.userInfo.imgPath=configs.imgPrefix+data,httpService.put("user/update",$scope.userInfo).success(function(d){loadUser()}),console.log("文件"+config.file.name+"上传成功")})}}]);