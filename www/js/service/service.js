"use strict";app.service("httpService",["$http","Config","$q",function($http,configs,$q){function getUrl(url){return configs.serverUrl+url}return{post:function(url,param,config){return url=getUrl(url),$http.post(url,$.param(param||{}),angular.extend({},{headers:{"Content-Type":"application/x-www-form-urlencoded"}},config))},get:function(url,config){return url=getUrl(url),$http.get(url,angular.extend({},{headers:{"Content-Type":"application/x-www-form-urlencoded"}},config))},put:function(url,param){return url=getUrl(url),$http.put(url,param,{headers:{"Content-Type":"application/x-www-form-urlencoded"}})},"delete":function(url){return url=getUrl(url),$http["delete"](url,{headers:{"Content-Type":"application/x-www-form-urlencoded"}})},createObject:function(url,param){url=getUrl(url);var defer=$q.defer();return $http.post(url,JSON.stringify(param),{headers:{"Content-Type":"application/json"}}).then(function(d){0!=d.data?defer.resolve(d):defer.reject("0行记录被添加")},function(e){e&&e.data?defer.reject(e.data):defer.reject({message:"添加失败"})}),defer.promise},updateObject:function(url,param){url=getUrl(url);var defer=$q.defer();return $http.put(url,JSON.stringify(param),{headers:{"Content-Type":"application/json"}}).then(function(d){0!=d.data?defer.resolve(d):defer.reject("0行记录被修改")},function(e){e&&e.data?defer.reject(e.data):defer.reject({message:"修改失败"})}),defer.promise}}}]).service("curUserService",["httpService","Config","$rootScope","$state","Popup",function(httpService,config,$rootScope,$state,Popup){this.doLogin=function(params){var promise=httpService.post("/login/signin",params);promise.then(function(d){if(d.data.success){var curUserReq=httpService.post("user/"+params.userName);curUserReq.success(function(data){data.imgPath||(data.imgPath=0==data.sex?"img/thumbnail-male.png":"img/thumbnail-female.png"),$rootScope.curUser=data,$rootScope.isLogined=!0,$rootScope.rememberMe=params.rememberMe,$state.go("app.self.index")})}else Popup.alert(d.data.message,function(){})})},this.doLogout=function(){$rootScope.isLogined=!1,$rootScope.curUser={},httpService.post("login/logout").success(function(d){$state.go("login.signin")})}}]).service("fileTransferHelper",["curUserService",function(curUserService){var param={};this.setter=function(p){param=p},this.getter=function(){return param}}]).factory("localStorage",["$window",function($window){return{set:function(key,value){$window.localStorage[key]=value},get:function(key,defaultValue){return $window.localStorage[key]||defaultValue},setObject:function(key,value){$window.localStorage[key]=JSON.stringify(value)},getObject:function(key){return JSON.parse($window.localStorage[key]||"{}")}}}]);